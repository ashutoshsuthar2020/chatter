apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "chat-app.fullname" . }}-config
  labels:
    {{- include "chat-app.labels" . | nindent 4 }}
data:
  # Application configuration
  APP_NAME: {{ .Values.global.appName | quote }}
  NODE_ENV: "development"  # Changed to development for better CORS handling
  
  # Redis configuration
  REDIS_HOST: {{ include "chat-app.redis.host" . | quote }}
  REDIS_PORT: {{ include "chat-app.redis.port" . | quote }}
  REDIS_URL: {{ printf "redis://%s:%s" (include "chat-app.redis.host" .) (include "chat-app.redis.port" .) | quote }}
  
  # MongoDB configuration
  MONGODB_URI: {{ .Values.externalMongodb.uri | quote }}
  
  # Server configuration
  SERVER_PORT: {{ .Values.server.service.port | quote }}
  
  # Client configuration
  CLIENT_PORT: {{ .Values.client.service.port | quote }}
  REACT_APP_API_URL: {{ .Values.global.reactAppApiUrl | default (printf "http://%s:%d" (include "chat-app.server.fullname" .) (.Values.server.service.port | int)) | quote }}
  
  # Additional environment variables
  {{- range $key, $value := .Values.global.extraEnvVars }}
  {{ $key }}: {{ $value | quote }}
  {{- end }}
